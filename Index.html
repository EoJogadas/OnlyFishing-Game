<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stardew Valley por√©m s√≥ pesca üé£</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      min-height: 100%; font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #87ceeb, #98fb98);
      display: flex; flex-direction: column; align-items: center; 
      padding: 20px 10px; overflow-x: auto;
    }
    
    .screen {
      display: none; flex-direction: column;
      align-items: center; padding: 2em; text-align: center;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px); margin: 20px 0;
      max-width: 95vw; width: 100%;
    }
    .active { display: flex; }
    
    h1 { color: #2c3e50; margin-bottom: 1em; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
    h2 { color: #34495e; margin-bottom: 1em; }
    
    canvas {
      border: 3px solid #2c3e50; 
      background: linear-gradient(180deg, #87ceeb 0%, #4682b4 70%, #2f4f4f 100%);
      border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      width: 100%; max-width: 400px; height: 600px;
      touch-action: manipulation;
    }
    
    button {
      margin: 0.5em; padding: 12px 24px; font-size: 1em; font-weight: bold;
      border: none; border-radius: 25px; 
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white; cursor: pointer; transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4); }
    button:active { transform: scale(0.95); }
    button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    
    #instagramButton {
      padding: 12px 24px;
      font-size: 1em;
      font-weight: bold;
      border: none;
      border-radius: 25px;
      background: linear-gradient(90deg, #800080, #FF0000, #FFFF00);
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      margin-top: 1em; /* Espa√ßamento abaixo do bot√£o Configura√ß√µes */
    }
    #instagramButton:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    }
    #instagramButton:active {
      transform: scale(0.95);
    }
    
    input[type=range] {
      width: 200px; margin: 1em;
      -webkit-appearance: none; appearance: none;
      height: 8px; border-radius: 5px; background: #ddd;
      outline: none;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none; appearance: none;
      width: 20px; height: 20px; border-radius: 50%;
      background: #4CAF50; cursor: pointer;
    }
    
    #progressBar {
      position: absolute; right: 10px; top: 10px;
      width: 30px; height: 150px;
      border: 3px solid #2c3e50; background: #ecf0f1;
      border-radius: 15px; overflow: hidden;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
      z-index: 10;
    }
    #progressFill {
      background: linear-gradient(0deg, #e74c3c, #f39c12, #f1c40f);
      width: 100%; height: 0; transition: height 0.2s ease;
      border-radius: 0 0 12px 12px;
    }
    
    #gameControls {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      gap: 15px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.9);
      padding: 15px 20px;
      border-radius: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      backdrop-filter: blur(10px);
      width: 90%;
      max-width: 500px;
      justify-content: center;
    }
    #gameControls.active {
      display: flex;
    }
    
    #gameControls button {
      margin: 0;
      min-width: 80px;
      flex: 1;
    }
    
    #inventoryPanel {
      display: none; flex-wrap: wrap; gap: 10px;
      background: rgba(255, 255, 255, 0.9); padding: 15px; border-radius: 15px;
      max-width: 90vw; margin-top: 1em;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .inventory-item {
      width: 70px; height: 70px; background: white;
      border: 3px solid #bdc3c7; border-radius: 12px;
      position: relative; display: flex; align-items: center; justify-content: center;
      transition: transform 0.2s ease;
      cursor: pointer;
    }
    .inventory-item:hover { transform: scale(1.05); }
    
    .tooltip {
      position: absolute; top: -80px; left: 50%;
      transform: translateX(-50%);
      background: rgba(44, 62, 80, 0.95); color: white;
      padding: 8px 12px; border-radius: 8px; font-size: 0.8em;
      display: none; z-index: 10; white-space: nowrap;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .inventory-item:hover .tooltip { display: block; }
    
    .stats {
      display: flex; gap: 20px; margin: 1em 0;
      flex-wrap: wrap; justify-content: center;
    }
    .stat {
      background: rgba(52, 73, 94, 0.1); padding: 8px 16px;
      border-radius: 20px; font-weight: bold;
    }
    
    .fish-sprite {
      width: 50px; height: 50px;
      image-rendering: pixelated;
    }
    
    #currentFish {
      display: flex; align-items: center; gap: 10px;
      justify-content: center; font-weight: bold;
      color: #2c3e50; margin: 0.5em 0;
    }
    
    .rarity-comum { border-color: #95a5a6 !important; }
    .rarity-raro { border-color: #3498db !important; }
    .rarity-√©pico { border-color: #9b59b6 !important; }
    .rarity-lend√°rio { border-color: #f39c12 !important; }
    
    @keyframes fishCaught {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    
    .fish-caught { animation: fishCaught 0.5s ease-in-out; }
    
    #pauseScreen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7); display: none; flex-direction: column;
      align-items: center; justify-content: center; z-index: 2000;
    }
    #pauseScreen.active { display: flex; }
    
    #achievements {
      display: none; flex-direction: column; gap: 10px;
      background: rgba(255, 255, 255, 0.9); padding: 15px; border-radius: 15px;
      max-width: 90vw; margin-top: 1em;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    .difficulty-comum { border-color: #95a5a6 !important; }
    .difficulty-medio { border-color: #3498db !important; }
    .difficulty-dificil { border-color: #e74c3c !important; }
    .difficulty-stardew { border-color: #f39c12 !important; }
    
    #achievementNotification {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: #2ecc71;
      color: white;
      padding: 15px 25px;
      border-radius: 25px;
      font-weight: bold;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
      z-index: 3000;
      width: 90%;
      max-width: 500px;
      opacity: 0;
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    #achievementNotification.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    #achievementNotification.hide {
      opacity: 0;
      transform: translateX(-50%) translateY(20px);
    }
    
    @media (max-width: 500px) {
      #gameControls {
        transform: translateX(-50%) scale(0.85);
        padding: 10px;
        gap: 8px;
        bottom: 5px;
      }
      #gameControls button {
        min-width: 80px;
        padding: 8px 12px;
        font-size: 0.85em;
      }
      canvas {
        max-width: 90vw;
        max-height: 70vh;
      }
      #achievementNotification {
        bottom: 70px;
        padding: 10px 20px;
      }
    }
  </style>
</head>
<body>

  <div id="titleScreen" class="screen active">
    <h1>üé£ Stardew Valley - S√≥ Pesca üé£</h1>
    <p>Capture peixes raros e construa sua cole√ß√£o!</p>
    <button onclick="goToLevelSelect()" aria-label="Iniciar aventura de pesca">üöÄ INICIAR AVENTURA</button>
  </div>

  <div id="levelScreen" class="screen">
    <h2>‚öôÔ∏è Configurar Dificuldade</h2>
    <p>Escolha seu n√≠vel de habilidade na pesca:</p>
    <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;">
      <button onclick="selectLevel('NOOB')" aria-label="Selecionar dificuldade NOOB">NOOB</button>
      <button onclick="selectLevel('INTERMEDIARIO')" aria-label="Selecionar dificuldade Intermedi√°rio">INTERMEDI√ÅRIO</button>
      <button onclick="selectLevel('PRO')" aria-label="Selecionar dificuldade PRO">PRO</button>
      <button onclick="selectLevel('STARDEW')" aria-label="Selecionar dificuldade Stardew">STARDEW</button>
    </div>
    <p id="levelText">N√≠vel Selecionado: NOOB</p>
    <p><em>NOOB: Barra grande, peixes de todas as raridades. STARDEW: Barra pequena, maiores chances de peixes raros.</em></p>
    <h3>üîä Configurar Volume</h3>
    <label for="masterVolume">Volume Mestre: <span id="masterVolumeValue">100%</span></label>
    <input id="masterVolume" type="range" min="0" max="1" step="0.1" value="1" oninput="updateVolume()" aria-label="Ajustar volume mestre">
    <label for="musicVolume">Volume da M√∫sica: <span id="musicVolumeValue">50%</span></label>
    <input id="musicVolume" type="range" min="0" max="1" step="0.1" value="0.5" oninput="updateVolume()" aria-label="Ajustar volume da m√∫sica">
    <label for="sfxVolume">Volume dos Efeitos: <span id="sfxVolumeValue">20%</span></label>
    <input id="sfxVolume" type="range" min="0" max="1" step="0.1" value="0.2" oninput="updateVolume()" aria-label="Ajustar volume dos efeitos">
    <button onclick="startGame()" aria-label="Come√ßar a pescar">üé£ COME√áAR A PESCAR</button>
  </div>

  <div id="gameScreen" class="screen">
    <div style="position: relative; display: inline-block;">
      <canvas id="gameCanvas" width="400" height="600"></canvas>
      <div id="progressBar">
        <div id="progressFill"></div>
      </div>
    </div>
    
    <div style="margin-top: 20px;">
      <div id="currentFish"></div>
      <div class="stats">
        <div class="stat">üêü Peixes: <span id="fishCount">0</span></div>
        <div class="stat">‚≠ê Pontos: <span id="scoreDisplay">0</span></div>
        <div class="stat">üéØ Streak: <span id="streakDisplay">0</span></div>
      </div>
      
      <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin: 15px 0;">
        <button onclick="toggleInventory()" aria-label="Ver invent√°rio">üì¶ Invent√°rio</button>
        <button onclick="sellFish()" id="sellBtn" aria-label="Vender todos os peixes">üí∞ Vender Tudo</button>
        <button onclick="toggleAchievements()" aria-label="Ver conquistas">üèÜ Conquistas</button>
      </div>
      
      <p id="status">Clique em "Lan√ßar Linha" para come√ßar sua jornada!</p>
    </div>
    
    <div id="inventoryPanel"></div>
    <div id="achievements"></div>
    
    <div id="pauseScreen" class="screen">
      <h2>Jogo Pausado</h2>
      <button onclick="togglePause()" aria-label="Retomar o jogo">‚ñ∂Ô∏è Retomar</button>
      <button onclick="goToLevelSelect()" aria-label="Voltar ao menu de n√≠veis">‚öôÔ∏è Configura√ß√µes</button>
      <button id="instagramButton" onclick="window.open('https://www.instagram.com/kaio_gabbriel/', '_blank')">Instagram</button>
    </div>
  </div>

  <div id="gameControls">
    <button id="launchBtn" onclick="startFishing()" aria-label="Lan√ßar linha de pesca">üéØ Lan√ßar Linha</button>
    <button id="holdBtn" aria-label="Segurar a linha">‚¨ÜÔ∏è SEGURAR</button>
    <button onclick="togglePause()" aria-label="Pausar o jogo">‚è∏Ô∏è Pausar</button>
  </div>

  <div id="achievementNotification"></div>

  <script>
    const screens = {
      title: document.getElementById('titleScreen'),
      level: document.getElementById('levelScreen'),
      game: document.getElementById('gameScreen'),
      pause: document.getElementById('pauseScreen')
    };

    const fishVariants = [
      { name: 'Til√°pia', behavior: 'Suave', intensity: 30, color: '#5DADE2', rarity: 'Comum', points: 10, difficulty: 0.5 },
      { name: 'Sardinha', behavior: 'Dardo', intensity: 50, color: '#85C1E9', rarity: 'Comum', points: 8, difficulty: 0.7 },
      { name: 'Carpa', behavior: 'Pesado', intensity: 40, color: '#A9DFBF', rarity: 'Comum', points: 12, difficulty: 0.6 },
      { name: 'Dourado', behavior: 'Flutuador', intensity: 70, color: '#F7DC6F', rarity: 'Raro', points: 35, difficulty: 0.9 },
      { name: 'Salm√£o', behavior: 'Misto', intensity: 60, color: '#F1948A', rarity: 'Raro', points: 40, difficulty: 0.9 },
      { name: 'Bagre', behavior: 'Pesado', intensity: 90, color: '#D2B4DE', rarity: '√âpico', points: 60, difficulty: 1.2 },
      { name: 'Robalo', behavior: 'Suave', intensity: 70, color: '#AED6F1', rarity: '√âpico', points: 55, difficulty: 1.1 },
      { name: 'Pirarucu', behavior: 'Dardo', intensity: 110, color: '#F8C471', rarity: 'Lend√°rio', points: 100, difficulty: 1.8 },
      { name: 'Atum', behavior: 'Misto', intensity: 40, color: '#4682B4', rarity: 'Comum', points: 15, difficulty: 0.6 },
      { name: 'Truta', behavior: 'Flutuador', intensity: 50, color: '#20B2AA', rarity: 'Comum', points: 10, difficulty: 0.5 },
      { name: 'Pintado', behavior: 'Suave', intensity: 35, color: '#8FBC8F', rarity: 'Comum', points: 12, difficulty: 0.4 },
      { name: 'Anchova', behavior: 'Dardo', intensity: 60, color: '#B0C4DE', rarity: 'Comum', points: 9, difficulty: 0.7 },
      { name: 'Cavalinha', behavior: 'Flutuador', intensity: 45, color: '#ADD8E6', rarity: 'Comum', points: 8, difficulty: 0.8 },
      { name: 'Linguado', behavior: 'Pesado', intensity: 65, color: '#DAA520', rarity: 'Raro', points: 30, difficulty: 0.9 },
      { name: 'Badejo', behavior: 'Misto', intensity: 55, color: '#FF6347', rarity: 'Raro', points: 35, difficulty: 0.8 },
      { name: 'Corvina', behavior: 'Suave', intensity: 60, color: '#FFA07A', rarity: 'Raro', points: 32, difficulty: 0.85 },
      { name: 'Pargo', behavior: 'Dardo', intensity: 75, color: '#FF4500', rarity: 'Raro', points: 38, difficulty: 0.9 },
      { name: 'Cioba', behavior: 'Flutuador', intensity: 85, color: '#FF69B4', rarity: '√âpico', points: 50, difficulty: 1.1 },
      { name: 'Garoupa', behavior: 'Pesado', intensity: 95, color: '#6A5ACD', rarity: '√âpico', points: 55, difficulty: 1.2 },
      { name: 'Mero', behavior: 'Misto', intensity: 80, color: '#9932CC', rarity: '√âpico', points: 60, difficulty: 1.3 },
      { name: 'Tubar√£o', behavior: 'Pesado', intensity: 105, color: '#2F4F4F', rarity: 'Lend√°rio', points: 90, difficulty: 1.7 },
      { name: 'Peixe-Lua', behavior: 'Flutuador', intensity: 120, color: '#FFD700', rarity: 'Lend√°rio', points: 120, difficulty: 1.9 },
      { name: 'Enguia', behavior: 'Suave', intensity: 45, color: '#228B22', rarity: 'Comum', points: 10, difficulty: 0.6 },
      { name: 'Pacu', behavior: 'Misto', intensity: 35, color: '#9ACD32', rarity: 'Comum', points: 11, difficulty: 0.5 },
      { name: 'Piramboia', behavior: 'Dardo', intensity: 70, color: '#8B008B', rarity: 'Raro', points: 33, difficulty: 0.85 },
      { name: 'Ja√∫', behavior: 'Pesado', intensity: 100, color: '#CD5C5C', rarity: '√âpico', points: 58, difficulty: 1.2 },
      { name: 'Arraia', behavior: 'Suave', intensity: 75, color: '#708090', rarity: '√âpico', points: 62, difficulty: 1.15 },
      { name: 'Peixe-Espada', behavior: 'Flutuador', intensity: 115, color: '#4682B4', rarity: 'Lend√°rio', points: 110, difficulty: 1.6 }
    ];

    const achievements = [
      { id: 'fish_10', name: 'Pescador Iniciante', description: 'Capture 10 peixes', condition: () => totalFishCount >= 10 },
      { id: 'score_500', name: 'Mestre dos Pontos', description: 'Alcance 500 pontos', condition: () => totalScore >= 500 },
      { id: 'streak_5', name: 'Sequ√™ncia de Sucesso', description: 'Mantenha um streak de 5', condition: () => streak >= 5 },
      { id: 'legendary', name: 'Lenda do Mar', description: 'Capture um peixe lend√°rio', condition: () => capturedFish.some(f => f.rarity === 'Lend√°rio') }
    ];

    let currentLevel = 'NOOB';
    let capturedFish = [];
    let totalScore = 0;
    let streak = 0;
    let totalFishCount = 0;
    const INVENTORY_LIMIT = 20;
    let isPaused = false;
    let lastFrameTime = 0;
    let fishInBar = false;

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    if (!ctx) {
      console.error('Contexto do canvas n√£o dispon√≠vel');
      document.getElementById('status').innerText = 'Erro: N√£o foi poss√≠vel inicializar o jogo.';
    }
    let bar = { y: 250, vy: 0, height: 140, holding: false };
    let fish = { y: 100, vy: 0, data: null };
    let fishTargetY = 0;
    let fishMoveTimer = 0;
    let gameRunning = false;
    let progress = 0;
    let frameCounter = 0;
    let targetFrames = 240;

    const backgroundMusic = new Audio('https://www.bensound.com/bensound-music/bensound-sunny.mp3');
    backgroundMusic.loop = true;
    const catchSound = new Audio('https://www.soundjay.com/buttons/button-09.mp3');
    const failSound = new Audio('https://www.soundjay.com/buttons/button-10.mp3');
    const inBarSound = new Audio('https://www.soundjay.com/buttons/button-11.mp3');
    inBarSound.loop = true;
    const bellSound = new Audio('https://www.soundjay.com/buttons/beep-01a.mp3'); // Placeholder para som de sino

    function updateVolume() {
      const masterVolume = parseFloat(document.getElementById('masterVolume').value);
      const musicVolume = parseFloat(document.getElementById('musicVolume').value);
      const sfxVolume = parseFloat(document.getElementById('sfxVolume').value);
      
      document.getElementById('masterVolumeValue').innerText = `${Math.round(masterVolume * 100)}%`;
      document.getElementById('musicVolumeValue').innerText = `${Math.round(musicVolume * 100)}%`;
      document.getElementById('sfxVolumeValue').innerText = `${Math.round(sfxVolume * 100)}%`;
      
      backgroundMusic.volume = masterVolume * musicVolume;
      catchSound.volume = masterVolume * sfxVolume;
      failSound.volume = masterVolume * sfxVolume;
      inBarSound.volume = masterVolume * sfxVolume;
      bellSound.volume = masterVolume * sfxVolume;
    }

    function configurarControles() {
      const holdBtn = document.getElementById('holdBtn');
      
      const startHold = () => { if (gameRunning && !isPaused) bar.holding = true; };
      const stopHold = () => { bar.holding = false; };
      
      holdBtn.addEventListener('mousedown', startHold);
      holdBtn.addEventListener('mouseup', stopHold);
      holdBtn.addEventListener('mouseleave', stopHold);
      holdBtn.addEventListener('touchstart', (e) => { e.preventDefault(); startHold(); });
      holdBtn.addEventListener('touchend', (e) => { e.preventDefault(); stopHold(); });
      
      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && gameRunning && !isPaused) {
          e.preventDefault();
          bar.holding = true;
        } else if (e.code === 'Escape' && gameRunning) {
          togglePause();
        } else if (e.code === 'Enter') {
          if (screens.title.classList.contains('active')) goToLevelSelect();
          else if (screens.level.classList.contains('active')) startGame();
        }
      });
      document.addEventListener('keyup', (e) => {
        if (e.code === 'Space') {
          e.preventDefault();
          bar.holding = false;
        }
      });

      window.addEventListener('scroll', () => {
        const gameControls = document.getElementById('gameControls');
        gameControls.style.bottom = '10px';
      });
    }

    function showScreen(name) {
      Object.values(screens).forEach(s => s.classList.remove('active'));
      screens[name].classList.add('active');
      const gameControls = document.getElementById('gameControls');
      gameControls.classList.toggle('active', name === 'game' && !isPaused);
      if (name === 'game' && !isPaused) {
        backgroundMusic.play().catch(() => console.warn('N√£o foi poss√≠vel tocar a m√∫sica de fundo.'));
      } else {
        backgroundMusic.pause();
      }
    }

    function goToLevelSelect() {
      showScreen('level');
      updateLevelText();
    }

    function selectLevel(level) {
      currentLevel = level;
      updateLevelText();
    }

    function updateLevelText() {
      const descriptions = {
        'NOOB': 'NOOB: Barra grande, peixes de todas as raridades.',
        'INTERMEDIARIO': 'INTERMEDIARIO: Barra m√©dia, melhores chances de peixes raros.',
        'PRO': 'PRO: Barra pequena, ainda mais chances de peixes raros.',
        'STARDEW': 'STARDEW: Barra muito pequena, maiores chances de peixes raros.'
      };
      document.getElementById('levelText').innerText = `N√≠vel Selecionado: ${currentLevel}`;
    }

    function startGame() {
      showScreen('game');
      resizeCanvas();
      initGame();
      configurarControles();
      document.getElementById('gameControls').classList.add('active');
    }

    function resizeCanvas() {
      const maxWidth = Math.min(window.innerWidth * 0.9, 400);
      const maxHeight = Math.min(window.innerHeight * 0.8, 600);
      canvas.width = maxWidth;
      canvas.height = maxHeight;
      ctx.scale(maxWidth / 400, maxHeight / 600);
      document.getElementById('gameControls').style.bottom = '10px';
      updateCanvasBorder();
    }

    function updateCanvasBorder() {
      const canvas = document.getElementById('gameCanvas');
      if (currentLevel === 'NOOB') canvas.className = 'difficulty-comum';
      else if (currentLevel === 'INTERMEDIARIO') canvas.className = 'difficulty-medio';
      else if (currentLevel === 'PRO') canvas.className = 'difficulty-dificil';
      else canvas.className = 'difficulty-stardew';
    }

    function initGame() {
      bar.height = currentLevel === 'NOOB' ? 140 : currentLevel === 'INTERMEDIARIO' ? 116 : currentLevel === 'PRO' ? 84 : 60;
      progress = 0;
      gameRunning = false;
      isPaused = false;
      fishInBar = false;
      frameCounter = 0;
      document.getElementById('launchBtn').disabled = false;
      document.getElementById('status').innerText = 'Clique em "Lan√ßar Linha" para come√ßar sua jornada!';
      document.getElementById('currentFish').innerHTML = '';
      loadProgress();
      updateInventory();
      updateStats();
      updateAchievements();
      updateVolume();
      backgroundMusic.play().catch(() => console.warn('N√£o foi poss√≠vel tocar a m√∫sica de fundo.'));
    }

    function getFishForLevel() {
      const availableFish = fishVariants; // Todos os peixes em todas as dificuldades
      
      let weights = [];
      if (currentLevel === 'NOOB') {
        weights = availableFish.map(f => {
          if (f.rarity === 'Comum') return 70;
          if (f.rarity === 'Raro') return 20;
          if (f.rarity === '√âpico') return 8;
          if (f.rarity === 'Lend√°rio') return 2;
          return 1;
        });
      } else if (currentLevel === 'INTERMEDIARIO') {
        weights = availableFish.map(f => {
          if (f.rarity === 'Comum') return 50;
          if (f.rarity === 'Raro') return 30;
          if (f.rarity === '√âpico') return 15;
          if (f.rarity === 'Lend√°rio') return 5;
          return 1;
        });
      } else if (currentLevel === 'PRO') {
        weights = availableFish.map(f => {
          if (f.rarity === 'Comum') return 30;
          if (f.rarity === 'Raro') return 35;
          if (f.rarity === '√âpico') return 25;
          if (f.rarity === 'Lend√°rio') return 10;
          return 1;
        });
      } else { // STARDEW
        weights = availableFish.map(f => {
          if (f.rarity === 'Comum') return 20;
          if (f.rarity === 'Raro') return 30;
          if (f.rarity === '√âpico') return 30;
          if (f.rarity === 'Lend√°rio') return 20;
          return 1;
        });
      }
      
      const totalWeight = weights.reduce((a, b) => a + b, 0);
      let random = Math.random() * totalWeight;
      
      for (let i = 0; i < availableFish.length; i++) {
        random -= weights[i];
        if (random <= 0) return availableFish[i];
      }
      
      return availableFish[0] || fishVariants[0];
    }

    function startFishing() {
      if (gameRunning || isPaused) return;
      
      fish.data = getFishForLevel();
      const difficultyMultiplier = fish.data.difficulty || 1;
      targetFrames = Math.floor(240 / difficultyMultiplier);
      
      document.getElementById('status').innerText = `Pescando ${fish.data.name}... Use ESPA√áO ou SEGURAR!`;
      document.getElementById('currentFish').innerHTML = `
        <div style="width: 30px; height: 30px; background: ${fish.data.color}; border-radius: 50%; border: 2px solid #2c3e50;"></div>
        <span>${fish.data.name} (${fish.data.rarity}) - ${fish.data.behavior}</span>
      `;
      
      bar.y = canvas.height / (canvas.width / 400) - bar.height - 50;
      bar.vy = 0;
      // Posi√ß√£o inicial do peixe abaixo da barra
      fish.y = bar.y + bar.height + 20; // Come√ßa 20px abaixo da barra
      fish.vy = 0;
      progress = 20;
      frameCounter = targetFrames * 0.2;
      fishMoveTimer = 30;
      gameRunning = true;
      fishInBar = false;
      document.getElementById('launchBtn').disabled = true;
      
      requestAnimationFrame(update);
    }

    function updateFishMovement() {
      const difficulty = fish.data?.difficulty || 1;
      const canvasHeight = canvas.height / (canvas.width / 400) * 0.8 - 60;
      const intensity = fish.data?.intensity || 20; // Intensidade m√≠nima 20 se n√£o definido

      fishMoveTimer--;
      if (fishMoveTimer <= 0) {
        // Ajusta a amplitude com base no comportamento e intensidade
        let amplitudeFactor = 1;
        if (fish.data.behavior === 'Dardo') amplitudeFactor = 1 + (intensity - 20) / 200; // De 1.0 a 1.5

        fishTargetY = Math.random() * canvasHeight * amplitudeFactor;
        if (fishTargetY > canvasHeight) fishTargetY = canvasHeight; // Limita a amplitude m√°xima
        fishMoveTimer = Math.floor(20 + Math.random() * 40 / difficulty);
      }

      let baseSpeed = 0.03 + difficulty * 0.02;
      let gravity = 0;

      // Ajusta a velocidade e acelera√ß√£o com base no comportamento e intensidade
      switch (fish.data.behavior) {
        case 'Suave':
          baseSpeed *= 0.7 + (120 - intensity) / 200; // De 0.7 (120) a 0.95 (20)
          break;
        case 'Pesado':
          gravity = 0.05 + (intensity - 20) / 400; // De 0.05 (20) a 0.15 (120)
          break;
        case 'Flutuador':
          gravity = -0.05 - (intensity - 20) / 400; // De -0.05 (20) a -0.15 (120)
          break;
        case 'Dardo':
          baseSpeed *= 1 + (intensity - 20) / 200; // De 1.0 (20) a 1.5 (120)
          break;
        case 'Misto':
        default:
          baseSpeed *= 0.9 + (intensity - 20) / 400; // De 0.9 (20) a 1.2 (120)
          break;
      }

      const dy = fishTargetY - fish.y;
      fish.vy = Math.max(-5, Math.min(5, dy * baseSpeed)) + gravity;
      fish.y += fish.vy;

      // Limite o peixe dentro da tela
      fish.y = Math.max(20, Math.min(canvasHeight + 20, fish.y));
    }

    function update(timestamp) {
      if (!gameRunning || isPaused) return;
      
      if (timestamp - lastFrameTime < 16.67) {
        requestAnimationFrame(update);
        return;
      }
      lastFrameTime = timestamp;

      const gravity = 0.8;
      const lift = -1.2;
      bar.vy += bar.holding ? lift : gravity;
      bar.vy *= 0.92;
      bar.y += bar.vy;
      
      if (bar.y < 0) { 
        bar.y = 0; 
        bar.vy = Math.max(0, bar.vy); 
      }
      if (bar.y + bar.height > canvas.height / (canvas.width / 400) * 0.8) {
        bar.y = canvas.height / (canvas.width / 400) * 0.8 - bar.height;
        bar.vy = Math.min(0, bar.vy);
      }

      updateFishMovement();

      const newFishInBar = fish.y >= bar.y && fish.y <= bar.y + bar.height;
      if (newFishInBar && !fishInBar) {
        inBarSound.play().catch(() => console.warn('N√£o foi poss√≠vel tocar o som de peixe na barra.'));
      } else if (!newFishInBar && fishInBar) {
        inBarSound.pause();
        inBarSound.currentTime = 0;
      }
      fishInBar = newFishInBar;

      if (fishInBar) {
        frameCounter += 1.5;
      } else {
        const decreaseRate = (currentLevel === 'NOOB') ? 0.5 : (currentLevel === 'INTERMEDIARIO') ? 0.75 : (currentLevel === 'PRO') ? 1 : 1.1;
        frameCounter -= decreaseRate;
      }
      
      frameCounter = Math.max(0, Math.min(targetFrames, frameCounter));
      progress = (frameCounter / targetFrames) * 100;
      document.getElementById('progressFill').style.height = `${progress}%`;

      drawGame();

      if (progress >= 100) {
        captureFish();
      } else if (frameCounter <= 0 && !fishInBar) {
        fishEscaped();
      } else {
        requestAnimationFrame(update);
      }
    }

    function drawGame() {
      ctx.clearRect(0, 0, 400, 600);
      
      const gradient = ctx.createLinearGradient(0, 0, 0, 600);
      gradient.addColorStop(0, '#87ceeb');
      gradient.addColorStop(0.7, '#4682b4');
      gradient.addColorStop(1, '#2f4f4f');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, 400, 600);
      
      ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
      for (let i = 0; i < 5; i++) {
        const x = (i * 60 + Date.now() / 50) % 400;
        const y = (i * 80 + Date.now() / 30) % 600;
        ctx.beginPath();
        ctx.arc(x, y, 3 + Math.sin(Date.now() / 200 + i), 0, Math.PI * 2);
        ctx.fill();
      }
      
      ctx.strokeStyle = '#8b4513';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(200, 0);
      ctx.lineTo(200, fish.y + 15);
      ctx.stroke();
      
      ctx.fillStyle = gameRunning && bar.holding ? '#27ae60' : '#2ecc71';
      ctx.fillRect(200 - 15, bar.y, 30, bar.height);
      ctx.strokeStyle = '#1e8449';
      ctx.lineWidth = 2;
      ctx.strokeRect(200 - 15, bar.y, 30, bar.height);
      
      if (fish.data) {
        if (fish.data.rarity === 'Lend√°rio') {
          ctx.shadowBlur = 15;
          ctx.shadowColor = 'yellow';
        } else {
          ctx.shadowBlur = 0;
        }
        
        ctx.fillStyle = fish.data.color;
        ctx.strokeStyle = '#2c3e50';
        ctx.lineWidth = 3;
        
        ctx.beginPath();
        ctx.moveTo(180, fish.y);
        ctx.lineTo(160, fish.y - 15);
        ctx.lineTo(160, fish.y + 15);
        ctx.closePath();
        ctx.fill();
        ctx.stroke();
        
        ctx.beginPath();
        ctx.ellipse(200, fish.y, 20, 15, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.stroke();
        
        ctx.shadowBlur = 0;
      }
      
      if (fishInBar) {
        ctx.fillStyle = 'rgba(46, 204, 113, 0.3)';
        ctx.fillRect(0, fish.y - 15, 400, 30);
      }
    }

    function captureFish() {
      if (capturedFish.length >= INVENTORY_LIMIT) {
        document.getElementById('status').innerText = `Invent√°rio cheio! Venda alguns peixes primeiro.`;
        inBarSound.pause();
        inBarSound.currentTime = 0;
        gameRunning = false;
        document.getElementById('launchBtn').disabled = false;
        return;
      }
      
      capturedFish.push(fish.data);
      totalScore += fish.data.points;
      streak += 1;
      totalFishCount += 1;
      
      catchSound.play().catch(() => console.warn('N√£o foi poss√≠vel tocar o som de captura.'));
      inBarSound.pause();
      inBarSound.currentTime = 0;
      
      saveProgress();
      updateInventory();
      updateStats();
      updateAchievements();
      
      document.getElementById('status').innerText = 
        `üéâ Voc√™ pescou ${fish.data.name}! +${fish.data.points} pontos (Streak: ${streak})`;
      
      document.getElementById('currentFish').classList.add('fish-caught');
      setTimeout(() => {
        document.getElementById('currentFish').classList.remove('fish-caught');
      }, 500);
      
      gameRunning = false;
      document.getElementById('launchBtn').disabled = false;
    }

    function fishEscaped() {
      document.getElementById('status').innerText = `üêü ${fish.data.name} escapou! Tente novamente.`;
      failSound.play().catch(() => console.warn('N√£o foi poss√≠vel tocar o som de falha.'));
      inBarSound.pause();
      inBarSound.currentTime = 0;
      streak = 0;
      updateStats();
      updateAchievements();
      gameRunning = false;
      document.getElementById('launchBtn').disabled = false;
    }

    function toggleInventory() {
      const panel = document.getElementById('inventoryPanel');
      panel.style.display = panel.style.display === 'flex' ? 'none' : 'flex';
      document.getElementById('achievements').style.display = 'none';
    }

    function toggleAchievements() {
      const panel = document.getElementById('achievements');
      panel.style.display = panel.style.display === 'flex' ? 'none' : 'flex';
      document.getElementById('inventoryPanel').style.display = 'none';
    }

    function updateInventory() {
      const panel = document.getElementById('inventoryPanel');
      panel.innerHTML = `<p>Invent√°rio: ${capturedFish.length}/${INVENTORY_LIMIT}</p>`;
      
      if (capturedFish.length === 0) {
        panel.innerHTML += '<p style="color: #7f8c8d; font-style: italic;">Seu invent√°rio est√° vazio. V√° pescar!</p>';
        return;
      }
      
      capturedFish.forEach((f, index) => {
        const item = document.createElement('div');
        item.className = `inventory-item rarity-${f.rarity.toLowerCase()}`;
        item.style.borderColor = f.color;

        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.innerHTML = `
          <strong>${f.name}</strong><br>
          ${f.behavior} ‚Ä¢ ${f.rarity}<br>
          üí∞ ${f.points} pontos
        `;
        item.appendChild(tooltip);

        const fishDiv = document.createElement('div');
        fishDiv.style.width = '40px';
        fishDiv.style.height = '40px';
        fishDiv.style.background = f.color;
        fishDiv.style.borderRadius = '50%';
        fishDiv.style.border = '2px solid white';
        item.appendChild(fishDiv);

        panel.appendChild(item);
      });
    }

    function updateStats() {
      document.getElementById('fishCount').innerText = totalFishCount;
      document.getElementById('scoreDisplay').innerText = totalScore;
      document.getElementById('streakDisplay').innerText = streak;
    }

    function updateAchievements() {
      const panel = document.getElementById('achievements');
      panel.innerHTML = '<h3>Conquistas</h3>';
      
      let newAchievement = false;
      achievements.forEach(ach => {
        const wasUnlocked = document.querySelector(`[data-achievement="${ach.id}"]`)?.dataset.unlocked === 'true';
        const isUnlocked = ach.condition();
        if (isUnlocked && !wasUnlocked) newAchievement = true;
        
        const item = document.createElement('div');
        item.setAttribute('data-achievement', ach.id);
        item.setAttribute('data-unlocked', isUnlocked);
        item.style.padding = '10px';
        item.style.background = isUnlocked ? '#2ecc71' : '#ecf0f1';
        item.style.borderRadius = '8px';
        item.innerHTML = `
          <strong>${ach.name}</strong><br>
          ${ach.description}<br>
          ${isUnlocked ? '‚úÖ Desbloqueada' : 'üîí Bloqueada'}
        `;
        panel.appendChild(item);
      });
      
      if (newAchievement) showAchievementNotification();
    }

    function showAchievementNotification() {
      const notification = document.getElementById('achievementNotification');
      const newAchievement = achievements.find(ach => ach.condition() && !document.querySelector(`[data-achievement="${ach.id}"]`)?.dataset.unlocked);
      if (newAchievement) {
        bellSound.play().catch(() => console.warn('N√£o foi poss√≠vel tocar o som de sino.'));
        notification.innerText = `üèÜ Nova Conquista: ${newAchievement.name}!`;
        notification.classList.remove('hide');
        notification.classList.add('show');
        setTimeout(() => {
          notification.classList.remove('show');
          notification.classList.add('hide');
        }, 4000);
      }
    }

    function sellFish() {
      if (capturedFish.length === 0) {
        document.getElementById('status').innerText = 'Voc√™ n√£o tem peixes para vender!';
        return;
      }
      
      const sellValue = capturedFish.reduce((total, fish) => total + fish.points, 0);
      const fishCount = capturedFish.length;
      
      capturedFish = [];
      totalScore += Math.floor(sellValue * 0.5);
      
      saveProgress();
      updateInventory();
      updateStats();
      updateAchievements();
      
      document.getElementById('status').innerText = 
        `üí∞ Vendido ${fishCount} peixes por +${Math.floor(sellValue * 0.5)} pontos b√¥nus!`;
    }

    function togglePause() {
      isPaused = !isPaused;
      screens.pause.classList.toggle('active');
      document.getElementById('gameControls').classList.toggle('active', !isPaused);
      document.getElementById('status').innerText = isPaused ? 'Jogo pausado' : `Clique em "Lan√ßar Linha" para continuar!`;
      if (isPaused) {
        backgroundMusic.pause();
        inBarSound.pause();
        inBarSound.currentTime = 0;
      } else if (gameRunning) {
        backgroundMusic.play().catch(() => console.warn('N√£o foi poss√≠vel tocar a m√∫sica de fundo.'));
        document.getElementById('gameControls').classList.add('active');
        requestAnimationFrame(update);
      }
    }

    function saveProgress() {
      const data = { capturedFish, totalScore, totalFishCount, streak };
      try {
        localStorage.setItem('stardewFishingProgress', JSON.stringify(data));
      } catch (e) {
        console.warn('Persist√™ncia de progresso n√£o dispon√≠vel. Seu progresso n√£o ser√° salvo.');
        document.getElementById('status').innerText = 'Aviso: Progresso n√£o ser√° salvo nesta plataforma.';
      }
    }

    function loadProgress() {
      try {
        const data = localStorage.getItem('stardewFishingProgress');
        if (data) {
          const parsed = JSON.parse(data);
          capturedFish = parsed.capturedFish || [];
          totalScore = parsed.totalScore || 0;
          totalFishCount = parsed.totalFishCount || 0;
          streak = parsed.streak || 0;
        }
      } catch (e) {
        console.warn('Erro ao carregar progresso. Iniciando novo jogo.');
      }
      updateInventory();
      updateStats();
      updateAchievements();
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();
    updateLevelText();
    updateVolume();
  </script>
</body>
                                                                                                   </html>
